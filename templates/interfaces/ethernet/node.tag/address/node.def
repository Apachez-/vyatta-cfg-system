multi:

type: txt

help: Set an IP address for this interface

# Syntax check at "set" time.  Give curent address value to script
# so that it can perform syntax check.
#
syntax:expression: exec "/opt/vyatta/sbin/vyatta-interfaces.pl --valid-addr-set $VAR(@) --dev $VAR(../@)"\
     ; "Invalid IP address/prefix [$VAR(@)] for interface $VAR(../@)"

# Syntax check at "commit" time.  Pass all address values to script so that
# it can perform consistency check.
#
commit:expression: exec "/opt/vyatta/sbin/vyatta-interfaces.pl --valid-addr-commit $VAR(@@) --dev $VAR(../@)"

create:
	ifname=$VAR(../@)
	param=$VAR(@)
	if [ "$param" = "dhcpv6" ]; then
	    if [ -n "$VAR(../dhcpv6-options/parameters-only)" ]; then
		echo "parameters-only is set"
		arg1="--parameters-only"
	    fi
	    if [ -n "$VAR(../dhcpv6-options/temporary)" ]; then
		echo "temporary is set"
		arg2="--temporary"
	    fi

	    echo "Starting DHCPv6 client on ${ifname}..."
            sudo /opt/vyatta/sbin/vyatta-dhcpv6-client.pl --start \
		--ifname $ifname $arg1 $arg2
	else
	    sudo /opt/vyatta/sbin/vyatta-interfaces.pl --eth-addr-update $VAR(@) --dev $VAR(../@)
	fi

delete:
	ifname=$VAR(../@)
	param=$VAR(@)
	if [ "$param" = "dhcpv6" ]; then
	    echo "Stopping DHCPv6 client on ${ifname}..."
            sudo /opt/vyatta/sbin/vyatta-dhcpv6-client.pl --stop --ifname \
		$ifname
	else
	    sudo /opt/vyatta/sbin/vyatta-interfaces.pl --eth-addr-delete $VAR(@) --dev $VAR(../@)
	fi

allowed: echo "dhcp dhcpv6 <>"

val_help:<x.x.x.x/x>; IP address and prefix length
val_help:<h:h:h:h:h:h:h:h/x>; IPv6 address and prefix length
val_help:dhcp; Dynamic Host Configuration Protocol
val_help:dhcpv6; Dynamic Host Configuration Protocol for IPv6
